# CollabU - 学生团队协作与项目管理系统

## 设计文档

---

## 一、系统概述

### 1.1 项目背景

CollabU 是一个专为学生团队设计的协作与项目管理平台。与传统的项目管理工具不同，CollabU 采用**扁平化、民主化**的协作模式，弱化上下级关系，强调团队成员之间的平等协作。

### 1.2 核心理念

```
❌ 传统层级模式: 负责人 → 分配任务 → 成员执行

✅ 扁平协作模式: 所有成员平等 → 共同拆解 → 自由认领 → 协作完成
```

### 1.3 系统特点

- **扁平化管理**: 所有成员权限平等，都可以创建和管理任务
- **协同任务拆解**: 团队成员共同将主任务拆解为子任务
- **自由认领机制**: 成员主动认领任务，支持多人协作同一任务
- **实时交流**: 任务内嵌讨论区和实时聊天，随时沟通
- **可视化进度**: 甘特图展示任务时间线和依赖关系

---

## 三、功能模块

### 3.1 用户管理模块

#### 功能列表

- 用户注册（支持学号注册）
- 用户登录（JWT 认证）
- 个人信息管理
- 头像上传
- 密码修改

#### 用户角色

由于采用扁平化设计，系统只区分：
- **系统管理员**: 管理整个平台
- **普通用户**: 所有注册用户，在团队内权限平等

---

### 3.2 团队管理模块

#### 功能列表

- 创建团队
- 编辑团队信息
- 生成邀请码/邀请链接
- 加入团队
- 退出团队
- 解散团队（需全员同意或创建者操作）

#### 团队成员权限（扁平化）

| 操作 | 权限 |
|------|------|
| 邀请成员 | 所有成员 |
| 创建项目 | 所有成员 |
| 管理项目 | 所有成员 |
| 退出团队 | 所有成员 |
| 解散团队 | 创建者 |

---

### 3.3 项目管理模块

#### 功能列表

- 创建项目
- 编辑项目信息
- 设置项目里程碑
- 项目进度跟踪
- 项目归档/删除

#### 项目状态

- `planning` - 规划中
- `in_progress` - 进行中
- `completed` - 已完成
- `archived` - 已归档

---

### 3.4 任务管理模块（核心）

#### 扁平化任务协作

```
主任务 (所有人可创建)
├── 子任务 (所有人可添加)
│   ├── 子子任务 (无限层级)
│   │   └── ...
│   └── 子子任务
├── 子任务
└── 子任务

每个任务节点:
├── 可由 0~N 人认领
├── 任何成员可编辑
├── 任何成员可添加子任务
└── 任何成员可更新进度
```

#### 任务权限（扁平化）

| 操作 | 谁可以做 |
|------|----------|
| 创建主任务 | 所有成员 |
| 添加子任务 | 所有成员 |
| 编辑任务 | 所有成员 |
| 认领/退出任务 | 所有成员 |
| 更新进度 | 任务参与者 |
| 删除任务 | 创建者 |

#### 自由认领机制

```
任务: 数据库设计
状态: 待认领

[我来做] ← 任何人点击即可加入

↓ 点击后

任务: 数据库设计
参与者: 张三
状态: 进行中

[我也参与] ← 其他人可以加入协作
```

#### 进度自动汇总

```
主任务进度 = 子任务完成比例自动计算

学生管理系统 [60%] ← 自动计算
├── 需求分析 [100%] ✓
├── 系统设计 [100%] ✓
├── 编码实现 [40%]
│   ├── 后端API [80%]
│   ├── 前端页面 [20%]
│   └── 数据库 [20%]
└── 测试部署 [0%]
```

#### 甘特图展示

```
任务名称          │ 第1周    │ 第2周    │ 第3周    │ 第4周
─────────────────┼──────────┼──────────┼──────────┼──────────
需求分析          │████████  │          │          │
 ├─用户调研       │████      │          │          │  张三
 └─需求文档       │    ████  │          │          │  张三
系统设计          │          │████████  │          │
 ├─数据库设计     │          │████      │          │  李四
 └─接口设计       │          │    ████  │          │  李四
编码实现          │          │          │██████████│██████████
 ├─后端开发       │          │          │██████████│          王五
 └─前端开发       │          │          │     █████│██████    赵六
```

甘特图交互功能：
- 双击任务条 → 编辑详情
- 拖拽边缘 → 调整时间
- 右键 → 添加子任务
- 连线 → 建立依赖关系

---

### 3.5 任务交流系统（核心）

#### 交流方式

```
任务交流
├── 💬 任务评论区 (异步讨论)
├── 🔴 实时聊天 (即时沟通)
├── 📢 动态更新 (自动记录)
└── 📎 文件分享 (资料共享)
```

#### 任务评论区

```
┌─────────────────────────────────────────────────┐
│ 💬 讨论区                                        │
│ ───────────────────────────────────────────────  │
│                                                  │
│ 张三  10:30                                      │
│ 登录用JWT还是Session？大家怎么看？               │
│     👍 2   💬 回复                                │
│     │                                            │
│     ├─ 李四  10:35                               │
│     │  JWT吧，前后端分离更方便                   │
│     │                                            │
│     └─ 王五  10:40                               │
│        同意，我之前用过JWT，可以分享下经验        │
│                                                  │
│ 李四  11:00                                      │
│ @张三 接口文档我放附件了，你看下                 │
│ 📎 login-api.md                                  │
│                                                  │
│ ─────────────────────────────────────────────── │
│ [输入评论...                    ] [📎] [发送]    │
└─────────────────────────────────────────────────┘
```

#### 实时聊天窗口

```
┌──────────────────────────────────────┐
│ 🔴 实时讨论 - 用户登录模块            │
│ 在线: 张三、李四                      │
├──────────────────────────────────────┤
│                                      │
│ 张三: 我这边登录接口写好了            │
│                           14:30      │
│                                      │
│ 李四: 好的，我来对接前端              │
│                           14:31      │
│                                      │
│ 张三: 端口是8080，接口是/api/login   │
│                           14:31      │
│                                      │
│ 李四: 收到 👌                         │
│                           14:32      │
│                                      │
├──────────────────────────────────────┤
│ [输入消息...]            [发送]      │
└──────────────────────────────────────┘
```

#### 动态时间线

系统自动记录任务的所有活动：

```
┌─────────────────────────────────────────────────┐
│ 📢 任务动态                                      │
├─────────────────────────────────────────────────┤
│ ● 12/24 15:00  王五 将进度更新为 80%            │
│ ● 12/24 14:30  李四 上传了文件 login.vue        │
│ ● 12/24 14:00  张三 添加了子任务 "记住密码功能" │
│ ● 12/24 11:00  李四 加入了此任务                │
│ ● 12/24 10:00  张三 创建了此任务                │
└─────────────────────────────────────────────────┘
```

#### 通知提醒

触发场景：
- 有人@你
- 你参与的任务有新评论
- 任务状态变更
- 任务即将到期
- 有人加入/退出你参与的任务
- 子任务被添加

---

### 3.6 文件共享模块

#### 功能列表

- 文件上传/下载
- 文件分类管理
- 在线预览（图片/PDF/文档）
- 文件关联到任务

---

### 3.7 日程管理模块

#### 功能列表

- 团队共享日历
- 会议安排
- 日程提醒
- 里程碑展示

---

## 四、数据库设计

### 4.1 用户表 (users)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| username | VARCHAR(50) | 用户名 |
| email | VARCHAR(100) | 邮箱 |
| password_hash | VARCHAR(255) | 密码哈希 |
| student_id | VARCHAR(20) | 学号 |
| real_name | VARCHAR(50) | 真实姓名 |
| avatar | VARCHAR(255) | 头像URL |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

### 4.2 团队表 (teams)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| name | VARCHAR(100) | 团队名称 |
| description | TEXT | 团队描述 |
| avatar | VARCHAR(255) | 团队头像 |
| invite_code | VARCHAR(20) | 邀请码 |
| creator_id | INT | 创建者ID |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

### 4.3 团队成员表 (team_members)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| team_id | INT | 团队ID |
| user_id | INT | 用户ID |
| role | VARCHAR(20) | 角色(creator/member) |
| joined_at | DATETIME | 加入时间 |

### 4.4 项目表 (projects)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| team_id | INT | 所属团队ID |
| name | VARCHAR(100) | 项目名称 |
| description | TEXT | 项目描述 |
| status | VARCHAR(20) | 状态 |
| start_date | DATE | 开始日期 |
| end_date | DATE | 结束日期 |
| created_by | INT | 创建者ID |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

### 4.5 任务表 (tasks)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| parent_id | INT | 父任务ID（支持无限层级） |
| project_id | INT | 所属项目ID |
| title | VARCHAR(200) | 任务标题 |
| description | TEXT | 任务描述 |
| status | VARCHAR(20) | 状态(pending/in_progress/completed) |
| priority | VARCHAR(10) | 优先级(high/medium/low) |
| progress | INT | 进度(0-100) |
| start_date | DATE | 开始日期 |
| end_date | DATE | 截止日期 |
| level | INT | 层级深度 |
| sort_order | INT | 同级排序 |
| created_by | INT | 创建者ID |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

### 4.6 任务参与者表 (task_participants)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| task_id | INT | 任务ID |
| user_id | INT | 用户ID |
| joined_at | DATETIME | 加入时间 |

### 4.7 任务评论表 (task_comments)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| task_id | INT | 任务ID |
| user_id | INT | 评论者ID |
| content | TEXT | 评论内容 |
| reply_to | INT | 回复的评论ID |
| created_at | DATETIME | 创建时间 |

### 4.8 任务实时消息表 (task_messages)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| task_id | INT | 任务ID |
| user_id | INT | 发送者ID |
| content | TEXT | 消息内容 |
| created_at | DATETIME | 创建时间 |

### 4.9 任务动态表 (task_activities)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| task_id | INT | 任务ID |
| user_id | INT | 操作者ID |
| action | VARCHAR(50) | 操作类型 |
| detail | JSON | 变更详情 |
| created_at | DATETIME | 创建时间 |

### 4.10 文件表 (files)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| team_id | INT | 团队ID |
| task_id | INT | 关联任务ID |
| filename | VARCHAR(255) | 文件名 |
| filepath | VARCHAR(500) | 存储路径 |
| filesize | INT | 文件大小 |
| mimetype | VARCHAR(100) | 文件类型 |
| uploader_id | INT | 上传者ID |
| created_at | DATETIME | 创建时间 |

### 4.11 通知表 (notifications)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| user_id | INT | 接收者ID |
| type | VARCHAR(50) | 通知类型 |
| content | TEXT | 通知内容 |
| related_id | INT | 关联ID |
| is_read | BOOLEAN | 是否已读 |
| created_at | DATETIME | 创建时间 |

---

## 五、API接口规划

### 5.1 认证接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/auth/register | POST | 用户注册 |
| /api/auth/login | POST | 用户登录 |
| /api/auth/logout | POST | 用户登出 |
| /api/auth/refresh | POST | 刷新Token |

### 5.2 用户接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/users/profile | GET | 获取个人信息 |
| /api/users/profile | PUT | 更新个人信息 |
| /api/users/avatar | POST | 上传头像 |
| /api/users/password | PUT | 修改密码 |

### 5.3 团队接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/teams | GET | 获取我的团队列表 |
| /api/teams | POST | 创建团队 |
| /api/teams/:id | GET | 获取团队详情 |
| /api/teams/:id | PUT | 更新团队信息 |
| /api/teams/:id | DELETE | 解散团队 |
| /api/teams/:id/members | GET | 获取团队成员 |
| /api/teams/:id/invite | POST | 生成邀请码 |
| /api/teams/join | POST | 加入团队 |
| /api/teams/:id/leave | POST | 退出团队 |

### 5.4 项目接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/projects | GET | 获取项目列表 |
| /api/projects | POST | 创建项目 |
| /api/projects/:id | GET | 获取项目详情 |
| /api/projects/:id | PUT | 更新项目 |
| /api/projects/:id | DELETE | 删除项目 |

### 5.5 任务接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/tasks | GET | 获取任务列表 |
| /api/tasks | POST | 创建任务 |
| /api/tasks/:id | GET | 获取任务详情 |
| /api/tasks/:id | PUT | 更新任务 |
| /api/tasks/:id | DELETE | 删除任务 |
| /api/tasks/:id/subtasks | POST | 添加子任务 |
| /api/tasks/:id/join | POST | 认领任务 |
| /api/tasks/:id/leave | POST | 退出任务 |
| /api/tasks/:id/progress | PUT | 更新进度 |

### 5.6 任务交流接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/tasks/:id/comments | GET | 获取评论列表 |
| /api/tasks/:id/comments | POST | 发表评论 |
| /api/tasks/:id/messages | GET | 获取聊天记录 |
| /api/tasks/:id/activities | GET | 获取任务动态 |

### 5.7 文件接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/files/upload | POST | 上传文件 |
| /api/files/:id | GET | 下载文件 |
| /api/files/:id | DELETE | 删除文件 |

### 5.8 WebSocket事件

| 事件 | 方向 | 说明 |
|------|------|------|
| task:message | 双向 | 任务实时消息 |
| task:update | 服务端→客户端 | 任务更新通知 |
| task:join | 客户端→服务端 | 加入任务房间 |
| task:leave | 客户端→服务端 | 离开任务房间 |
| notification | 服务端→客户端 | 系统通知 |

---

---

## 七、实现步骤

### 第一阶段：基础架构

1. 搭建Flask后端框架
2. 搭建前端框架
3. 配置数据库连接
4. 实现用户认证系统（注册/登录/JWT）

### 第二阶段：核心功能

5. 实现团队管理功能
6. 实现项目管理功能
7. 实现任务管理功能（含无限层级子任务）
8. 实现甘特图展示

### 第三阶段：协作功能

9. 实现任务评论功能
10. 实现实时聊天功能（WebSocket）
11. 实现文件共享功能
12. 实现通知系统

### 第四阶段：完善优化

13. 实现日程管理
14. 添加数据统计
15. 界面优化与测试
16. 部署上线

---

## 八、技术要点

### 8.1 JWT认证

使用Flask-JWT-Extended实现无状态认证，Token有效期设置为24小时。

### 8.2 实时通信

使用Flask-SocketIO实现：
- 任务内实时聊天
- 任务更新实时推送
- 在线状态显示

### 8.3 无限层级任务

使用parent_id自关联实现无限层级，通过递归查询获取任务树。

### 8.4 进度自动计算

父任务进度 = 子任务完成数 / 子任务总数 × 100

---

*文档版本: 1.0*
*最后更新: 2024年12月*
